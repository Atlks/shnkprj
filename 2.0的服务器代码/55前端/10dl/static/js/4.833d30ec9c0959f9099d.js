webpackJsonp([4],{"/QWa":function(t,a,e){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var s=e("bOdI"),i=e.n(s),n=e("gyMJ"),l=e("mtWM"),o=e.n(l),c=e("mw3O"),p=e.n(c),d={name:"messagePush",data:function(){var t;return t={headers:{headers:{token:localStorage.getItem("token")}},radio:1,radio2:3,cert_urlShow:!1,cert_url:"",bund_id:"",newtitle:"",newsubtitle:"",newmsg:"",newpush_time:"",newequipment_num:"",newpush_type:""},i()(t,"cert_url",""),i()(t,"typeState",1),i()(t,"riTime",""),i()(t,"isHave",0),i()(t,"startTime",""),i()(t,"endTime",""),i()(t,"zhengPass",""),i()(t,"isTui",!1),i()(t,"timeShow",!1),i()(t,"value1",""),i()(t,"choose",!0),i()(t,"choose1",!0),i()(t,"choose2",!0),i()(t,"pushTitle",""),i()(t,"fupushTitle",""),i()(t,"pushContent",""),i()(t,"mask",!1),i()(t,"mask1",!1),i()(t,"mask2",!1),i()(t,"mask3",!1),i()(t,"mask4",!1),i()(t,"value",""),i()(t,"total",0),i()(t,"pageNumber",""),i()(t,"current",1),i()(t,"tableData",[]),i()(t,"limitCount",1),t},methods:{newuploadp12:function(t){var a=this,e=new FormData;o.a.get(n.a+"/api/common/ossToken",this.headers).then(function(s){0==s.data.code?a.$message.error(s.data.msg):(e.append("policy",s.data.data.policy),e.append("success_action_status",200),e.append("signature",s.data.data.signature),e.append("OSSAccessKeyId",s.data.data.accessid),e.append("name",a.$md5(t.file.name.split(".p12")[0])+Math.round(new Date/1e3)+".p12"),e.append("key",s.data.data.dir+a.$md5(t.file.name.split(".p12")[0])+Math.round(new Date/1e3)+".p12"),e.append("file",t.file),a.cert_url=s.data.data.dir+a.$md5(t.file.name.split(".p12")[0])+Math.round(new Date/1e3)+".p12",o.a.post(s.data.data.host,e,a.headers).then(function(t){0==t.data.code&&a.$message.error(t.data.msg)},function(t){a.$message.error("上传p12包失败")}))},function(t){a.$message.error("上传p12包失败")})},yanBtn:function(){var t=this;this.mask4=!1;var a={app_id:this.$route.query.id,cert_url:this.cert_url,password:this.zhengPass};o.a.post(n.a+"/api/app/pushCert",p.a.stringify(a),this.headers).then(function(a){0==a.data.code?t.$message.error(a.data.msg):(t.isHave=1,t.$message({message:"保存成功",type:"success"}))},function(t){})},zhinan:function(){this.mask3=!1},bangzhu:function(){this.mask3=!0},zhengUpload:function(){this.mask2=!1,this.mask4=!0},zhengCancel:function(){this.mask2=!1},tableTr:function(t){var a=this;this.mask1=!0,this.newtitle="",this.newsubtitle="",this.newmsg="",this.newpush_time="",this.newequipment_num="";var e={id:t.id,type:2};o.a.post(n.a+"/api/push/pushHandle",p.a.stringify(e),this.headers).then(function(t){a.newtitle=t.data.data.title,a.newsubtitle=t.data.data.subtitle,a.newmsg=t.data.data.msg,a.newpush_time=t.data.data.push_time,a.newequipment_num=t.data.data.equipment_num},function(t){})},chakanClick:function(t,a){var e=this;this.mask1=!0,this.newtitle="",this.newsubtitle="",this.newmsg="",this.newpush_time="",this.newequipment_num="";var s={id:a,type:2};o.a.post(n.a+"/api/push/pushHandle",p.a.stringify(s),this.headers).then(function(t){e.newtitle=t.data.data.title,e.newsubtitle=t.data.data.subtitle,e.newmsg=t.data.data.msg,e.newpush_time=t.data.data.push_time,e.newequipment_num=t.data.data.equipment_num},function(t){})},deleteClick:function(t,a){var e=this;this.$confirm("此操作将永久删除该文件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var t={id:a,type:1};o.a.post(n.a+"/api/push/pushHandle",p.a.stringify(t),e.headers).then(function(t){var a={app_id:e.$route.query.id,start:e.startTime,end:e.endTime,page:1,page_size:5};o.a.post(n.a+"/api/push/pushLog",p.a.stringify(a),e.headers).then(function(t){e.isHave=t.data.data.cert_path,e.total=t.data.data.total,e.pageNumber=parseInt(Math.ceil(Number(e.total)/5)),e.tableData=t.data.data.list,e.newpush_type=t.data.data.push_type},function(t){})},function(t){})}).catch(function(){})},firstTime:function(){var t=this;this.startTime=this.value[0],this.endTime=this.value[1];var a={app_id:this.$route.query.id,start:this.startTime,end:this.endTime,page:1,page_size:5};o.a.post(n.a+"/api/push/pushLog",p.a.stringify(a),this.headers).then(function(a){t.isHave=a.data.data.cert_path,t.total=a.data.data.total,t.pageNumber=parseInt(Math.ceil(Number(t.total)/5)),t.tableData=a.data.data.list,t.newpush_type=a.data.data.push_type},function(t){})},indexChange:function(t){var a=this,e={app_id:this.$route.query.id,start:this.startTime,end:this.endTime,page:t,page_size:5};o.a.post(n.a+"/api/push/pushLog",p.a.stringify(e),this.headers).then(function(t){a.isHave=t.data.data.cert_path,a.total=t.data.data.total,a.pageNumber=parseInt(Math.ceil(Number(a.total)/5)),a.tableData=t.data.data.list,a.newpush_type=t.data.data.push_type},function(t){})},pageChange:function(t){},plan:function(){this.typeState=1,this.pushTitle="",this.fupushTitle="",this.pushContent="",this.choose=!0,this.choose1=!0,this.timeShow=!1,this.value1="",2==this.newpush_type?(this.mask=!0,this.mask2=!1):1==this.isHave?(this.mask=!0,this.mask2=!1):(this.mask=!1,this.mask2=!0)},planSet:function(){this.zhengPass="",this.mask4=!0},close:function(){this.mask=!1,this.mask1=!1,this.mask4=!1},agreeChange:function(t){1==t?(this.timeShow=!1,this.typeState=1):(this.timeShow=!0,this.typeState=0)},ok:function(){var t=this;this.mask=!1;var a={app_id:this.$route.query.id,title:this.pushTitle,subtitle:this.fupushTitle,msg:this.pushContent,now:this.typeState,time:this.riTime};o.a.post(n.a+"/api/push/sendMessage",p.a.stringify(a),this.headers).then(function(a){if(0==a.data.code)t.$message.error(a.data.msg);else{var e={app_id:t.$route.query.id,start:t.startTime,end:t.endTime,page:1,page_size:5};o.a.post(n.a+"/api/push/pushLog",p.a.stringify(e),t.headers).then(function(a){0==a.data.code?t.$message.error(a.data.msg):(t.$message({message:"新增成功",type:"success"}),t.isHave=a.data.data.cert_path,t.total=a.data.data.total,t.pageNumber=parseInt(Math.ceil(Number(t.total)/5)),t.tableData=a.data.data.list,t.newpush_type=a.data.data.push_type)},function(t){})}},function(t){})},cancel:function(){this.mask=!1},chooseTimeRange:function(t){this.riTime=t},handleRemove:function(t,a){this.cert_url=""},handleChange:function(t,a){this.fileList=a.slice(-3)}},mounted:function(){var t=this,a={id:this.$route.query.id};o.a.post(n.a+"/api/app/appDes",p.a.stringify(a),this.headers).then(function(a){null!=a.data.data.cert_path?t.cert_urlShow=!0:t.cert_urlShow=!1,t.cert_url=a.data.data.cert_path,t.bund_id=a.data.data.package_name},function(a){t.$message.error("系统错误")});var e={app_id:this.$route.query.id,start:this.startTime,end:this.endTime,page:1,page_size:5};o.a.post(n.a+"/api/push/pushLog",p.a.stringify(e),this.headers).then(function(a){t.isHave=a.data.data.cert_path,t.total=a.data.data.total,t.pageNumber=parseInt(Math.ceil(Number(t.total)/5)),t.tableData=a.data.data.list,t.newpush_type=a.data.data.push_type,1==a.data.data.push_type?t.isTui=!0:t.isTui=!1},function(t){})}},r={render:function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{attrs:{id:"messagePush"}},[e("div",{staticClass:"messagePush"},[e("el-dialog",{attrs:{title:"创建推送计划",visible:t.mask,width:"628px","close-on-click-modal":!1},on:{"update:visible":function(a){t.mask=a}}},[e("div",{staticClass:"maskContent"},[e("div",{staticClass:"maskContentOne"},[e("p",{staticClass:"text"},[t._v("推送标题")]),t._v(" "),e("el-input",{staticClass:"firstInput",attrs:{maxlength:"15",placeholder:"0-15个字符，中英文数字特殊字符"},model:{value:t.pushTitle,callback:function(a){t.pushTitle=a},expression:"pushTitle"}})],1),t._v(" "),e("div",{staticClass:"maskContentOne"},[e("p",{staticClass:"text"},[t._v("推送副标题")]),t._v(" "),e("el-input",{staticClass:"firstInput",attrs:{maxlength:"15",placeholder:"0-15个字符，中英文数字特殊字符"},model:{value:t.fupushTitle,callback:function(a){t.fupushTitle=a},expression:"fupushTitle"}})],1),t._v(" "),e("div",{staticClass:"maskContentOne"},[e("p",{staticClass:"text"},[t._v("推送内容")]),t._v(" "),e("el-input",{staticClass:"firstInput",attrs:{placeholder:"内容过多可能导致信息显示不全"},model:{value:t.pushContent,callback:function(a){t.pushContent=a},expression:"pushContent"}})],1),t._v(" "),e("div",{staticClass:"maskContenttime"},[e("p",{staticClass:"text"},[t._v("推送时间")]),t._v(" "),e("div",{staticClass:"liji"},[e("el-radio-group",{attrs:{size:"medium"},on:{change:t.agreeChange},model:{value:t.radio,callback:function(a){t.radio=a},expression:"radio"}},[e("el-radio",{attrs:{label:1}},[t._v("立即推送")]),t._v(" "),e("el-radio",{attrs:{label:2}},[t._v("定时推送")])],1)],1)]),t._v(" "),t.timeShow?e("div",{staticClass:"block"},[e("el-date-picker",{attrs:{"value-format":"yyyy-MM-dd HH:mm:ss",align:"bottom",type:"datetime",placeholder:"选择日期时间"},on:{change:t.chooseTimeRange},model:{value:t.value1,callback:function(a){t.value1=a},expression:"value1"}})],1):t._e(),t._v(" "),e("div",{staticClass:"maskContentpeople "},[e("p",{staticClass:"text"},[t._v("推送人群")]),t._v(" "),e("div",{staticClass:"liji"},[e("el-radio",{attrs:{label:3},model:{value:t.radio2,callback:function(a){t.radio2=a},expression:"radio2"}},[t._v("全部用户")])],1)]),t._v(" "),e("div",{staticClass:"maskContentOne"},[e("p",{staticClass:"text"}),t._v(" "),e("div",{staticClass:"footer"},[e("div",{staticClass:"ok",on:{click:t.ok}},[t._v("确定推送")]),t._v(" "),e("div",{staticClass:"cancel",on:{click:t.cancel}},[t._v("取消")])])])])]),t._v(" "),e("el-dialog",{attrs:{title:"查看",visible:t.mask1,width:"628px","close-on-click-modal":!1},on:{"update:visible":function(a){t.mask1=a}}},[e("div",{staticClass:"maskContent newmaskContent"},[e("div",{staticClass:"maskContentOne"},[e("p",{staticClass:"text"},[t._v("推送标题")]),t._v(" "),e("p",{staticClass:"textTwo"},[t._v(t._s(t.newtitle))])]),t._v(" "),e("div",{staticClass:"maskContentOne"},[e("p",{staticClass:"text"},[t._v("推送副标题")]),t._v(" "),e("p",{staticClass:"textTwo"},[t._v(t._s(t.newsubtitle))])]),t._v(" "),e("div",{staticClass:"maskContentOne"},[e("p",{staticClass:"text"},[t._v("推送内容")]),t._v(" "),e("p",{staticClass:"textTwo"},[t._v(t._s(t.newmsg))])]),t._v(" "),e("div",{staticClass:"maskContentOne"},[e("p",{staticClass:"text"},[t._v("推送时间")]),t._v(" "),e("p",{staticClass:"textTwo"},[t._v(t._s(t.newpush_time))])]),t._v(" "),e("div",{staticClass:"maskContentOne "},[e("p",{staticClass:"text"},[t._v("推送人数")]),t._v(" "),e("p",{staticClass:"textTwo"},[t._v(t._s(t.newequipment_num))])])])]),t._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:t.mask2,expression:"mask2"}],staticClass:"mask"},[e("div",{staticClass:"newmask2Content"},[e("img",{attrs:{src:"//wbpp.h83k.net/static/image/myApp/newtishi.png",alt:""}}),t._v(" "),e("p",[t._v("请先上传证书，在创建推送计划")]),t._v(" "),e("div",{staticClass:"tishiBtn"},[e("div",{on:{click:t.zhengUpload}},[t._v("上传证书")]),t._v(" "),e("div",{on:{click:t.zhengCancel}},[t._v("取消")])])])]),t._v(" "),e("el-dialog",{attrs:{title:"推送方式配置",visible:t.mask4,width:"628px","close-on-click-modal":!1},on:{"update:visible":function(a){t.mask4=a}}},[e("div",{staticClass:"newmask4Content"},[e("div",{staticClass:"maskContentOne2"},[e("p",{staticClass:"mask4text"},[t._v("Bundle ID")]),t._v(" "),e("p",{staticClass:"textTwo"},[t._v(t._s(t.bund_id))])]),t._v(" "),e("div",{staticClass:"maskContentOne2"},[e("p",{staticClass:"mask4text"},[t._v("请选择鉴权方式")]),t._v(" "),e("p",{staticClass:"textTwo"},[t._v("证书")])]),t._v(" "),e("div",{staticClass:"maskContentOne2"},[e("p",{staticClass:"mask4text"},[t._v("证书配置")]),t._v(" "),e("el-upload",{staticClass:"upload-demo",attrs:{limit:t.limitCount,accept:".p12","on-remove":t.handleRemove,action:"string","http-request":t.newuploadp12,"on-change":t.handleChange}},[e("div",{staticClass:"uploadBtn"},[e("img",{attrs:{src:"//wbpp.h83k.net/static/image/myApp/shangchuanicon.png",alt:""}}),t._v(" "),e("p",[t._v("立即上传")])]),t._v(" "),e("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[t._v("只能上传.p12文件")])]),t._v(" "),e("p",{directives:[{name:"show",rawName:"v-show",value:t.cert_urlShow,expression:"cert_urlShow"}],staticStyle:{color:"red","margin-left":"15px","text-align":"left","font-size":"18px"}},[t._v("已上传")])],1),t._v(" "),e("div",{staticClass:"maskContentOne2"},[e("p",{staticClass:"mask4text"},[t._v("证书密码")]),t._v(" "),e("el-input",{staticClass:"secondInput",attrs:{placeholder:"请输入密码"},model:{value:t.zhengPass,callback:function(a){t.zhengPass=a},expression:"zhengPass"}})],1),t._v(" "),e("div",{staticClass:"maskContentOne2"},[e("p",{staticClass:"mask4text"}),t._v(" "),e("div",{staticClass:"yanz",on:{click:t.yanBtn}},[e("p",[t._v("验证")])])])])]),t._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:t.mask3,expression:"mask3"}],staticClass:"zhinanmask",on:{click:t.zhinan}},[e("img",{attrs:{src:"//wbpp.h83k.net/static/image/myApp/zhinan.png",alt:""}})]),t._v(" "),e("div",{staticClass:"first"},[e("div",{staticClass:"btn",on:{click:t.plan}},[t._v("创建推送计划")]),t._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:t.isTui,expression:"isTui"}],staticClass:"btn1",on:{click:t.planSet}},[t._v("推送方式配置")]),t._v(" "),e("img",{staticClass:"bangzhu",attrs:{src:"//wbpp.h83k.net/static/image/myApp/bangzhu.png",alt:""},on:{click:t.bangzhu}}),t._v(" "),e("div",{staticClass:"time"},[e("DatePicker",{attrs:{size:"large",format:"yyyy-MM-dd",clearable:!1,type:"daterange","split-panels":"",placeholder:"请选择时间段"},on:{"on-change":function(a){return t.firstTime(t.value=a)}},model:{value:t.value,callback:function(a){t.value=a},expression:"value"}})],1)]),t._v(" "),e("div",{staticClass:"consumptionRecordDiv"},[e("div",{staticClass:"secondDiv"},[e("el-table",{staticStyle:{width:"100%","font-size":"13.8px"},attrs:{data:t.tableData,stripe:"","header-cell-style":{background:"#EFF1FA"}},on:{"row-click":t.tableTr}},[e("el-table-column",{attrs:{prop:"push_time",label:"推送时间",align:"center"}}),t._v(" "),e("el-table-column",{attrs:{prop:"equipment_num",label:"推送设备数",align:"center"}}),t._v(" "),e("el-table-column",{attrs:{prop:"status",align:"center",label:"状态"},scopedSlots:t._u([{key:"default",fn:function(a){return[1===a.row.status?e("span",{staticStyle:{color:"#43A047"}},[t._v("已推送")]):0===a.row.status?e("span",{staticStyle:{color:"#999999"}},[t._v("未推送")]):-1===a.row.status?e("span",{staticStyle:{color:"#999999"}},[t._v("推送失败")]):t._e()]}}])}),t._v(" "),e("el-table-column",{attrs:{prop:"money",label:"操作",align:"center"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("div",{staticClass:"caodiv"},[e("div",{staticClass:"chakan",on:{click:function(e){return t.chakanClick(a.row,t.tableData[a.$index].id)}}},[t._v("查看")]),t._v(" "),e("div",{staticClass:"chakan",on:{click:function(e){return e.stopPropagation(),t.deleteClick(a.row,t.tableData[a.$index].id)}}},[t._v("删除")])])]}}])})],1)],1),t._v(" "),e("div",{staticClass:"paging"},[e("p",[t._v("共"),e("span",{staticStyle:{color:"red"}},[t._v(t._s(t.pageNumber))]),t._v(" 页/ "),e("span",{staticStyle:{color:"red"}},[t._v(t._s(t.total))]),t._v("条记录")]),t._v(" "),e("Page",{attrs:{"page-size":5,current:t.current,total:t.total},on:{"on-change":t.indexChange,"on-page-size-change":t.pageChange}})],1)])],1)])},staticRenderFns:[]};var u=e("VU/8")(d,r,!1,function(t){e("neG1"),e("X0tQ")},"data-v-fd8298fe",null);a.default=u.exports},X0tQ:function(t,a){},neG1:function(t,a){}});