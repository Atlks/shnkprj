webpackJsonp([11],{"2zyS":function(a,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=t("bOdI"),s=t.n(i),n=t("gyMJ"),d=t("mtWM"),o=t.n(d),r=t("mw3O"),l=t.n(r),p=t("TX6m"),c=t("35HW"),m={name:"myAppDetail",data:function(){var a;return a={loading:!1,progressFlag:!1,progressPercent:0,customColor:"#157df1",ipaParsing:"",ipaData:{},is_overseas:"10",isUpdate:!1,headers:{headers:{token:localStorage.getItem("token")}},crumbs:[{name:"分发应用详情"}],merge_app:[],loading2:!1,new_id:""},s()(a,"loading",!1),s()(a,"applist",""),s()(a,"modal1",!1),s()(a,"headers",{headers:{token:localStorage.getItem("token")}}),s()(a,"icon",""),s()(a,"score_num",""),s()(a,"remark",""),s()(a,"desc",""),s()(a,"introduction",""),s()(a,"name",""),s()(a,"url",""),s()(a,"version_code",""),s()(a,"package_name",""),s()(a,"download_url",""),s()(a,"state",""),s()(a,"enable",""),s()(a,"imgList",[]),s()(a,"status",!1),s()(a,"id",""),a},components:{Header:p.a,Footer:c.a},methods:{gengxing:function(){this.isUpdate=!0},goBack:function(){this.$router.push({path:"/distributeAppList"})},remarkBtn:function(){var a=this,e={remark:this.remark,id:this.$route.query.id};o.a.post(n.a+"/api/flow/update_remark",l.a.stringify(e),this.headers).then(function(e){0==e.data.code?a.$message.error(e.data.msg):a.$message.success(e.data.msg)},function(a){console.log(a)})},tipclick:function(a){console.log(a),this.applist.forEach(function(a){a.state=!1});var e=this.applist[a];e.state=!0,this.$set(this.applist,a,e),this.new_id=this.applist[a].id,console.log(this.applist)},hebing:function(){var a=this;this.modal1=!0,this.loading=!0;var e={id:this.$route.query.id};o.a.post(n.a+"/api/flow/get_merge_app",l.a.stringify(e),this.headers).then(function(e){if(0==e.data.code)a.$message.error(e.data.msg);else{a.applist=e.data.data;for(var t=0;t<a.applist.length;t++)a.applist[t].state=!1;a.loading=!1}},function(a){console.log(a)})},hebingOk:function(){var a=this;this.modal1=!1;var e={yum_id:this.$route.query.id,new_id:this.new_id};o.a.post(n.a+"/api/flow/merge_app",l.a.stringify(e),this.headers).then(function(e){0==e.data.code?a.$message.error(e.data.msg):(a.$message.success(e.data.msg),a.$router.push({path:"/distribute"}))},function(a){console.log(a)})},copy:function(){var a=this,e=new Clipboard(".fuzhi");e.on("success",function(t){a.$message({message:"复制成功",type:"success"}),e.destroy()}),e.on("error",function(a){console.log("该浏览器不支持自动复制"),e.destroy()})},beforeUpload:function(a){var e=a.name;console.log(e.substring(e.length-3)),this.uploadType=e.substring(e.length-3)},newuploadipa:function(a){var e=this;if(console.log("上传的是"+this.uploadType),"ipa"==this.uploadType){var t=new FormData,i=Math.round(new Date/1e3);o.a.get(n.a+"/api/app/init",this.headers).then(function(s){e.ipaParsing=s.data.data.ipaParsing,e.is_overseas=s.data.data.is_overseas;var d={is_overseas:e.is_overseas};o.a.post(n.a+"/api/common/ossToken",d,e.headers).then(function(s){e.dir=s.data.data.dir,t.append("policy",s.data.data.policy),t.append("success_action_status",200),t.append("signature",s.data.data.signature),t.append("OSSAccessKeyId",s.data.data.accessid),t.append("name",e.$md5(a.file.name.split(".ipa")[0])+i+".ipa"),t.append("key",s.data.data.dir+e.$md5(a.file.name.split(".ipa")[0])+i+".ipa"),t.append("file",a.file),e.progressFlag=!0;var d={headers:{token:localStorage.getItem("token")},onUploadProgress:function(a){e.progressPercent=Number((a.loaded/a.total*100).toFixed(2))}};o.a.post(s.data.data.host,t,d).then(function(t){if(0==t.data.code)e.$message.error(t.data.msg),e.progressPercent=0;else{var s={is_overseas:e.is_overseas,path:e.dir+e.$md5(a.file.name.split(".ipa")[0])+i+".ipa"};o.a.post(e.ipaParsing,s,e.headers).then(function(t){if(e.progressFlag=!1,e.progressPercent=0,0==t.data.code)e.$message.error(t.data.msg);else if(e.loading=!0,e.id){var s={is_overseas:e.is_overseas,path:e.dir+e.$md5(a.file.name.split(".ipa")[0])+i+".ipa",bundle_name:t.data.data.bundle_name,domain:t.data.data.domain,filesize:t.data.data.filesize,package_name:t.data.data.package_name,url:t.data.data.url,display_name:t.data.data.display_name,icon:t.data.data.icon,icon_url:t.data.data.icon_url,ipa_data_bak:t.data.data.ipa_data_bak,version_code:t.data.data.version_code,version_name:t.data.data.version_name,id:e.id};o.a.post(n.a+"/api/flow/update",l.a.stringify(s),e.headers).then(function(a){0==a.data.code?(e.loading=!1,e.$message.error(a.data.msg)):(e.loading=!1,e.$router.push({path:"/distribute"}))},function(a){e.$message.error("上传ipa包失败")})}else{var d={is_overseas:e.is_overseas,path:e.dir+e.$md5(a.file.name.split(".ipa")[0])+i+".ipa",bundle_name:t.data.data.bundle_name,domain:t.data.data.domain,filesize:t.data.data.filesize,package_name:t.data.data.package_name,url:t.data.data.url,display_name:t.data.data.display_name,icon:t.data.data.icon,icon_url:t.data.data.icon_url,ipa_data_bak:t.data.data.ipa_data_bak,version_code:t.data.data.version_code,version_name:t.data.data.version_name};o.a.post(n.a+"/api/flow/add",l.a.stringify(d),e.headers).then(function(a){0==a.data.code?(e.loading=!1,e.$message.error(a.data.msg)):(e.loading=!1,e.$router.push({path:"/distribute"}))},function(a){e.$message.error("上传ipa包失败")})}},function(a){e.$message.error("上传ipa包失败")})}},function(a){e.$message.error("上传ipa包失败")})},function(a){})},function(a){e.$message.error("上传ipa包失败")})}else{var s,d=new FormData;i=Math.round(new Date/1e3);o.a.get(n.a+"/api/app/init",this.headers).then(function(t){e.ipaParsing=t.data.data.ipaParsing,e.is_overseas=t.data.data.is_overseas;var r={is_overseas:e.is_overseas};o.a.post(n.a+"/api/common/ossToken",r,e.headers).then(function(t){e.dir=t.data.data.dir,d.append("policy",t.data.data.policy),d.append("success_action_status",200),d.append("signature",t.data.data.signature),d.append("OSSAccessKeyId",t.data.data.accessid),d.append("name",e.$md5(a.file.name.split(".apk")[0])+i+".apk"),d.append("key",t.data.data.dir+e.$md5(a.file.name.split(".ipa")[0])+i+".apk"),d.append("file",a.file),s=t.data.data.dir+e.$md5(a.file.name.split(".ipa")[0])+i+".apk",e.progressFlag=!0;var r={headers:{token:localStorage.getItem("token")},onUploadProgress:function(a){e.progressPercent=Number((a.loaded/a.total*100).toFixed(2))}};o.a.post(t.data.data.host,d,r).then(function(a){if(0==a.data.code)e.$message.error(a.data.msg),e.progressPercent=0;else{var t={is_overseas:e.is_overseas,path:s};o.a.post(n.a+"/api/common/apkParsing",t,e.headers).then(function(a){if(e.progressFlag=!1,e.progressPercent=0,0==a.data.code)e.$message.error(a.data.msg);else if(e.loading=!0,e.id){var t={is_overseas:e.is_overseas,path:s,bundle_name:a.data.data.bundle_name,package_name:a.data.data.package_name,filesize:a.data.data.filesize,compileSdkVersion:a.data.data.compileSdkVersion,compileSdkVersionCodename:a.data.data.compileSdkVersionCodename,display_name:a.data.data.display_name,icon:a.data.data.icon,icon_url:a.data.data.icon_url,ipa_data_bak:a.data.data.ipa_data_bak,version_code:a.data.data.version_code,version_name:a.data.data.version_name,id:e.id};o.a.post(n.a+"/api/flow/update",l.a.stringify(t),e.headers).then(function(a){0==a.data.code?(e.loading=!1,e.$message.error(a.data.msg)):(e.loading=!1,e.$router.push({path:"/distribute"}))},function(a){e.$message.error("上传apk包失败")})}else{var i={is_overseas:e.is_overseas,path:s,bundle_name:a.data.data.bundle_name,package_name:a.data.data.package_name,filesize:a.data.data.filesize,compileSdkVersion:a.data.data.compileSdkVersion,compileSdkVersionCodename:a.data.data.compileSdkVersionCodename,display_name:a.data.data.display_name,icon:a.data.data.icon,icon_url:a.data.data.icon_url,ipa_data_bak:a.data.data.ipa_data_bak,version_code:a.data.data.version_code,version_name:a.data.data.version_name};o.a.post(n.a+"/api/flow/add",l.a.stringify(i),e.headers).then(function(a){0==a.data.code?(e.loading=!1,e.$message.error(a.data.msg)):(e.loading=!1,e.$router.push({path:"/distribute"}))},function(a){e.$message.error("上传apk包失败")})}},function(a){e.$message.error("上传apk包失败")})}},function(a){e.$message.error("上传ipa包失败")})},function(a){})},function(a){e.$message.error("上传ipa包失败")})}}},mounted:function(){var a=this;this.loading2=!0,this.id=this.$route.query.id;var e={id:this.$route.query.id};o.a.post(n.a+"/api/flow/detail",l.a.stringify(e),this.headers).then(function(e){(e.data.code=200)?(a.loading2=!1,a.icon=e.data.data.icon,a.url=e.data.data.url,a.name=e.data.data.name,a.version_code=e.data.data.version_code,a.package_name=e.data.data.package_name,a.merge_app=e.data.data.merge_app,a.remark=e.data.data.remark,0==e.data.data.status?(a.state="未上架",a.enable="否"):(a.state="已上架",a.enable="是")):a.loading2=!1},function(e){a.$message.error("系统错误")})}},u={render:function(){var a=this,e=a.$createElement,t=a._self._c||e;return t("div",{attrs:{id:"myAppDetail"}},[t("Header"),a._v(" "),t("div",{staticClass:"myAppDetailMain"},[t("el-breadcrumb",{attrs:{separator:"/"}},[t("el-breadcrumb-item",{attrs:{to:{path:"/"}}},[a._v("超级签管理系统")]),a._v(" "),t("el-breadcrumb-item",{attrs:{to:{path:"/distribute"}}},[a._v("分发应用")]),a._v(" "),a._l(a.crumbs,function(e,i){return t("el-breadcrumb-item",{key:i},[a._v(a._s(e.name))])})],2),a._v(" "),t("div",{staticClass:"myAppDetailFirst"},[t("div",{staticClass:"myAppDetailFirstMain"},[t("el-dialog",{directives:[{name:"loading",rawName:"v-loading",value:a.loading,expression:"loading"}],attrs:{title:"更新",visible:a.isUpdate,width:"910px","close-on-click-modal":!1},on:{"update:visible":function(e){a.isUpdate=e}}},[t("div",{staticClass:"supplement"},[t("div",{staticClass:"supplementMain"},[t("div",{staticClass:"upload"},[t("div",{staticClass:"uploadDiv",staticStyle:{display:"flex","justify-content":"center"}},[t("el-upload",{staticClass:"upload-demo",attrs:{"show-file-list":!1,"before-upload":a.beforeUpload,drag:"",data:a.ipaData,accept:".ipa,.apk",action:"string","http-request":a.newuploadipa,multiple:""}},[t("i",{staticClass:"el-icon-upload"}),a._v(" "),t("div",{staticClass:"el-upload__text"},[a._v("将文件拖到此处，或"),t("em",[a._v("点击上传")])])])],1),a._v(" "),1==a.progressFlag?t("el-progress",{attrs:{percentage:a.progressPercent,color:a.customColor}}):a._e()],1)])])]),a._v(" "),t("Modal",{staticClass:"jiazaiDiv",attrs:{title:"选择App",closable:!1},model:{value:a.modal1,callback:function(e){a.modal1=e},expression:"modal1"}},[t("div",{directives:[{name:"loading",rawName:"v-loading",value:a.loading,expression:"loading"}],staticClass:"jiaziaDivMain"},a._l(a.applist,function(e,i){return t("div",{staticClass:"listdiv",class:{isBorColor:e.state},on:{click:function(e){return a.tipclick(i)}}},[t("img",{attrs:{src:e.icon,alt:""}}),a._v(" "),t("p",[a._v(a._s(e.name))])])}),0),a._v(" "),t("div",{staticClass:"queOk",attrs:{slot:"footer"},on:{click:a.hebingOk},slot:"footer"},[a._v("保存修改")])]),a._v(" "),t("div",{directives:[{name:"loading",rawName:"v-loading",value:a.loading2,expression:"loading2"}],staticClass:"appDetailsSecond"},[t("div",{attrs:{id:"appBrief"}},[t("div",{staticClass:"appBriefMain"},[t("div",{staticClass:"appBriefMainFirst"},[t("div",{staticClass:"appBriefMainFirstIcon"},[t("img",{staticClass:"iconImg",attrs:{src:a.icon,alt:""}}),a._v(" "),t("div",{staticClass:"information"},[t("div",{staticClass:"informationDiv",staticStyle:{display:"flex","align-items":"center"}},[t("p",[a._v(a._s(a.name)+" ")]),a._v(" "),t("p",{staticClass:"stateclass"},[a._v(a._s(a.state))])]),a._v(" "),t("p",{staticClass:"version"},[a._v(a._s(a.version_code))])])]),a._v(" "),t("div",{staticClass:"appBriefMainFirstRight",staticStyle:{display:"flex"}},[t("div",{staticClass:"appBriefMainFirstRightDiv",staticStyle:{width:"200px"}},[t("button",{staticClass:"hebing",on:{click:a.hebing}},[a._v("合并应用")])]),a._v(" "),t("div",{staticClass:"appBriefMainFirstRightDiv",staticStyle:{width:"200px"}},[t("button",{staticClass:"hebing",on:{click:a.gengxing}},[a._v("更新应用")])])])]),a._v(" "),t("div",{staticClass:"appBriefMainTwo"},[t("p",{staticClass:"titleNmae"},[a._v("下载地址")]),a._v(" "),t("p",{staticClass:"titleValue2"},[a._v(a._s(a.url))]),a._v(" "),a.url?t("button",{staticClass:"fuzhi",attrs:{"data-clipboard-text":a.url},on:{click:a.copy}},[a._v("复制")]):a._e()]),a._v(" "),t("div",{staticClass:"appBriefMainTwo"},[t("p",{staticClass:"titleNmae"},[a._v("包名")]),a._v(" "),t("p",{staticClass:"titleValue"},[a._v(a._s(a.package_name))])]),a._v(" "),t("div",{staticClass:"appBriefMainTwo"},[t("p",{staticClass:"titleNmae"},[a._v("是否启用")]),a._v(" "),t("p",{staticClass:"titleValue"},[a._v(a._s(a.enable))])]),a._v(" "),t("div",{staticClass:"appBriefMainTwo"},[t("p",{staticClass:"titleNmae"},[a._v("备注")]),a._v(" "),t("el-input",{staticClass:"titleValue",model:{value:a.remark,callback:function(e){a.remark=e},expression:"remark"}}),a._v(" "),t("button",{staticClass:"remarkBtn",on:{click:a.remarkBtn}},[a._v("保存")])],1),a._v(" "),t("div",{staticClass:"appBriefMainTwo"},[t("p",{staticClass:"titleNmae"},[a._v("合并的应用")]),a._v(" "),null!=a.merge_app?t("div",{staticClass:"titleValue titleValuenew"},[t("img",{staticClass:"iconImg",attrs:{src:a.merge_app.icon,alt:""}}),a._v(" "),t("p",[a._v(a._s(a.merge_app.name)+" "),1==a.merge_app.type?t("span",[a._v("（ios）")]):t("span",[a._v("（apk）")])])]):t("p",{staticClass:"titleValue"},[a._v("无")])])])])])],1)])],1),a._v(" "),t("Footer")],1)},staticRenderFns:[]};var _=t("VU/8")(m,u,!1,function(a){t("kBUk"),t("B8gc")},"data-v-437b3e09",null);e.default=_.exports},B8gc:function(a,e){},kBUk:function(a,e){}});